import pandas as pd

configfile: "config.yaml"

meta = pd.read_table(config['path_meta']).set_index(config['sample_column'], drop=False)
samples = list(meta.index)

path_data = config['path_data']
path_results = config['path_results']

rule all:
    input:
        expand(path_results+"/hill_div/{sample}_hill.tsv", sample=samples),
        path_results+"/hill_all.tsv",
        path_results+"/auc_all.tsv",

rule hill_div:
    input:
        meta=path_data+'metadata.txt',
        rear=path_data+'{sample}.tsv'
    output:
        hill_div=path_results+'/hill_div/{sample}_hill.tsv',
    conda:
        "envs/Hill_Div.yaml"
    script:
        'scripts/Hill_Diversity_v2.R'

rule concat_hill:
    input:
        in_path=expand(path_results+"/hill_div/{sample}_hill.tsv", sample=samples),
    output:
        hill_out=path_results+"/hill_all.tsv",
        auc_out =path_results+"/auc_all.tsv",
    conda:
        "envs/Hill_Div.yaml"
    script:
        'scripts/concat_Hill.R'
